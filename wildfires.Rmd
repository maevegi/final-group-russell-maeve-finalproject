---
Title: Wilfire Frequency, Severity and Climate Change in California
author: Russell Huang and Maeve Gilbert
output: 
 html_document:
   df_print: paged 
 github_document: 
---
```{r}
library(tidyverse)
#install.packages(raster)
library(raster)
library(tmap)
library(terra)
library(sf)
library(ggplot2)
library(stars)
```

Read in the data sets. 
```{r} 
fire <- read_csv("https://incidents.fire.ca.gov/imapdata/mapdataall.csv",
                 col_types="ccTTc?ccddccddcccTDDcll")
```

Selecting relevant columns from the data. 
```{r}
#colnames(fire)

acres<-fire |>
  dplyr::select(incident_name, incident_date_created, incident_county, incident_location, incident_acres_burned, incident_longitude, incident_latitude) |>
  mutate(year = str_extract(incident_date_created, "\\d{4}")) |>
  group_by(year) |>
    summarise(total_acres_burned = sum(incident_acres_burned, na.rm = TRUE))

acres
```


```{r}
graph<- acres|>
  ggplot(aes(x=year, y=total_acres_burned))+
  geom_point()+
  xlab("Year")+
  ylab("Number of Acres Burned")+
  #scale_y_continuous(labels = )
  ggtitle("Acres burned in CA Wildfires, 1969-2023")


scales::label_number()
```


```{r}
plot(new, max.plot=17)
points(x = fire$incident_longitude, y= fire$incident_latitude, col = "red")


#create new raster for each year
#group by year, map all incidents per year on one raster, create one raster per year
#need to combine all incidents for each year and calculate total acres burned per year
```
We need to read in climate data, determine whether this should be monthly or daily values. Also should see if we can incorporate a spatial element to this, for example using a raster of California to plot fire spatial distribution over time. 

California shapefile. 
```{r}
download.file("https://data.ca.gov/dataset/e212e397-1277-4df3-8c22-40721b095f33/resource/3db1e426-fb51-44f5-82d5-a54d7c6e188b/download/ca-state-boundary.zip", "ca-state-boundary.zip")
unzip("ca-state-boundary.zip")
CAfile<- "https://data.ca.gov/dataset/e212e397-1277-4df3-8c22-40721b095f33/resource/3db1e426-fb51-44f5-82d5-a54d7c6e188b/download/ca-state-boundary.zip" 

CAurl<- paste0("/vsizip/vsicurl/", CAfile)
shapefile<- read_sf(CAurl)
summary(shapefile)

tm_shape(shapefile)+ tm_polygons("ALAND")
tm_shape(shapefile)+tm_polygons("GEOID")
```

Counties shapefile from folder CA_Counties
```{r}

download.file("https://data.ca.gov/dataset/e212e397-1277-4df3-8c22-40721b095f33/resource/b0007416-a325-4777-9295-368ea6b710e6/download/ca-county-boundaries.zip", "ca-county-boundaries.zip")
unzip("ca-county-boundaries.zip")
counties<-"https://data.ca.gov/dataset/e212e397-1277-4df3-8c22-40721b095f33/resource/b0007416-a325-4777-9295-368ea6b710e6/download/ca-county-boundaries.zip"
counties_url<-paste0("/vsizip/vsicurl/", counties)

  
tmap_options(max.categories=58) 
counties_sf<-read_sf("CA_Counties", layer="CA_Counties_TIGER2016")
summary(counties_sf)
plot(counties_sf)
CA<-tm_shape(counties_sf) + tm_polygons("COUNTYFP")
plot(CA)

```
Trying shapefile from folder "County".
```{r}
new<-read_sf("County", layer="CaliforniaCounty", quiet=TRUE)
plot(new)
tm_shape(new, projection="box")+tm_polygons("COUNTFP")+ points(x = fire$incident_longitude, y= fire$incident_latitude, col = "red")

st_bbox(new)


#make bounding box to define coordinates 
```

```{r}

download.file("https://www.ncei.noaa.gov/data/nclimgrid-monthly/access/nclimgrid_tavg.nc", "nclimgrid_tavg.nc")
```

